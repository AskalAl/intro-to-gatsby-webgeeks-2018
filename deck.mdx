export { default as theme } from './theme'
import { FullScreenCode, Invert } from 'mdx-deck/layouts'
import { Appear, Image } from 'mdx-deck'

# Intro to Gatsby
It's the future, y'all
---
# What is Gatsby?
- Static site builder
- Built using React components
- Has many adapters (Markdown, WordPress, Stripe)
- Leverages GraphQL for fetching data within components

```notes
- Bullets
- $3.8M in seed funding
- Have a hosted cloud version for $$$, similar to WP, Ghost model
```
---
# Installing Gatsby

<div style={{ fontSize: '1.5em' }}>

```
yarn global add gatsby-cli
gatsby new my-gatsby-project
cd my-new-project && yarn develop
```

</div>
---
export default FullScreenCode

```jsx
  // src/pages/index.js

  import React from 'react'
  import Link from 'gatsby-link'
  const IndexPage = () => (
    <div>
      <h1>Hi people</h1>
      <p>Welcome to your new Gatsby site.</p>
      <p>Now go build something great.</p>
      <Link to="/page-2/">Go to page 2</Link>
    </div>
  )
  export default IndexPage
```
---
export default FullScreenCode

```jsx
  // src/pages/page-2.js

  import React from 'react'
  import Link from 'gatsby-link'

  const SecondPage = () => (
    <div>
      <h1>Hi from the second page</h1>
      <p>Welcome to page 2</p>
      <Link to="/">Go back to the homepage</Link>
    </div>
  )

  export default SecondPage
```
---
<Image src='images/gatsby_starter.png' />
---
# Then what?

- Customize
- Build
- Amazon S3, Netlify, GitHub Pages, Surge.sh, Aerobatic, Now.sh, & many more

```notes
- Changes are hot-reloaded
- You can deploy to a number of places, either a hosted static site provider
- You could even use a simple web server
```
---
# So what?
- How is Gatsby different?
- Shouldn't I just use Jekyll?

```notes
- What's so special about Gatsby then?
- What about Jekyll, which was kind of a defacto static site builder forever
- Or Middleman for building more complex apps
```
---
export default Invert

# Here's what
---
# Modern Development

```notes
- Besides being built with React and Webpack...
- PWA
- Code and data splitting
- Loads only critical HTML, CSS, and data
- Prefetches important assets
- You have to do none of this!
```
---
<Image src='https://pmcvariety.files.wordpress.com/2016/02/transformers-age-of-extinction.jpg' />
---
# Transformers
- Markdown
- Images
- JSON
- YAML
- CSV

---
# Source Plugins
- WordPress
- Netlify CMS
- Vimeo, Trello, Craft, MongoDB, Stripe

---
# But where's the data?

```js
const wordPressData = await fetch('https://your.wordpress.sit/wp-json/wp/v2/posts')
  .then(d => d.json())
const stripeData = await fetch('https://api.stripe.com/transactions')
  .then(d => d.json());
// blah blah blah a million more times
```

```notes
- So if you were building a project with Jekyll or a vanilla static site
- Normally have to do this
- Is this necessary for Gatsby?
```
---
# Nope

```notes
- Transformers work behind the scenes on build
- They move the data into a queryable format for the front-end components
- That format is...
```
---
# GraphQL
- It's used in Gatsby
- Gosh, it's a real treat

```notes
- How many of you have heard of it?
- (reveal)
- It's gonna blow your minds
- Gatsby leverages this in some really cool ways to expose your data
- How does GraphQL work?
```
---
export default Invert

# GraphQL, Explained
---
> GraphQL is a query language for APIs and a runtime for fulfilling those queries with your existing data.

```notes
- Like writing SQL, but to a JSON endpoint
- Open-source, built by Facebook
```
---
> Ask for what you need, get exactly that

```notes
- Most REST APIs return the entire record (or records), when all you really want is a title
```
---
## Describe your data

```graphql
type Project {
  name: String
  tagline: String
  contributors: [User]
}
```

```notes
- Define the type with all possible fields
- This allows GraphQL to be self-documenting
- Tools can introspect which fields are available
```
---
## Ask for what you want

```graphql
{
  project(name: "GraphQL") {
    tagline
  }
}
```

```notes
- I want the project
- Named graphql
- But I only need the tagline
```
---
## Get predictable results

```json
{
  "project": {
    "tagline": "A query language for APIs"
  }
}
```
---
# GraphQL in Gatsby

- Compiles all sources and pages into a GraphQL data source
- Allows you to write queries in your components
- Extracts queries at build time and inserts the data
---
<Image src='images/graphql_1.png' />

```notes
- Gatsby exposes a GraphQL UI out of the box
- Note the query on the left. We're fetching all site pages
- Asking for specific fields: id, path, jsonName
- Docs are available + autocomplete!
```
---
export default Invert

# Let's build Web Geeks in Gatsby!
---
<Image src='images/wg_homepage.png' />

```notes
- Here it is
- We list upcoming events
- That's what we'll focus on
```
---
## Get the blog ready

```diff
// register_post_type()
'public' => true,
+'show_in_rest' => true,
+'rest_base' => 'events',
'has_archive' => true,
```

```sh
wp plugin add --activate acf-to-rest-api
```

```notes
- WP ships with a REST API by default now!
- We had to do a little house keeping, though
- First, include the custom post type 'events' in the API with a couple lines
- Also renamed the prefix instead of wg_events
- Installed the ACF plugin because we have important event data in ACF
- That's it!
```
---
## Step 1: WordPress Source Plugin

<div style={{ fontSize: '1.5em' }}>

```sh
gatsby new webgeeks-gatsby
cd webgeeks-gatsby
yarn add gatsby-source-wordpress
```

```notes
We start by creating a new Gatsby project and including the official WordPress source plugin
```

</div>
---
## Step 2: Configure it

```json
{
  plugins: [
    {
      resolve: 'gatsby-source-wordpress',
      options: {
        baseUrl: 'dsmwebgeeks.com',
        protocol: 'http',
        useACF: true
      }
    }
  ]
}
```
---
<video src="images/gatsby_build.mp4" autoPlay loop muted />

```notes
- At build time, Gatsby fetches all posts, pages, events, etc from the WordPress API
- Stores them locally
- This can really be a slow process if you have a ton of data! We only have 42 events
```
---
<Image src='images/gatsby_wp_graphql.png' />

```notes
- But now that all the WP data is part of Gatsby, we can use GraphQL to query everything in WordPress
- This is super cool and powerful. You can't even do this in WordPress.
```
---
## Step 3: Update the UI
---
<Image src='images/ui_initial.png' />

```notes
- With some minor color and content changes, we have the base for a new website
- Isn't that sexy??
```
---
export default FullScreenCode

```jsx
export const eventsQuery = graphql`
  query eventsQuery {
    allWordpressWpEvents {
      edges {
        node {
          title
          featured_media {
            source_url
          }
          acf {
            event_date
            event_time
          }
        }
      }
    }
  }
`
```

```notes
- We start by writing the query within pages/index.js
- We want title, featured image, and date/time of event from ACF
```
---
export default FullScreenCode

```jsx
return (
  <div>
    <h1>What events are coming up?</h1>

    <div style={{ ... }}>
      {data.allWordpressWpEvents.edges.map(({ node }, index) => (
        <div key={index}>
          <img src={node.featured_media.source_url} alt={node.title} />
          <h3>{node.title}</h3>
          <p>{node.acf.event_date}</p>
        </div>
      ))}
    </div>
  </div>
)
```

```notes
- That data is automatically passed as a prop to the Gatsby page component
- We use that data to display what we want
```
---
<Image src='images/ui_step1.png' />

```notes
- Here it is! Not super great, but it's a start.
- Takeaways:
- I discover that I hate writing inline CSS-in-JS
- Also I am a horrible designer
```
---
# Typography.js to the Rescue!

```notes
- In the Gatsby docs
- It's a CSS reset + basic typography settings, including scales etc
- Built for React/modules
- Super fun themes
```
---
```sh
yarn add gatsby-plugin-typography typography-theme-fairy-gates
```

```notes
- Even better, there's a plugin for Gatsby
- I chose the fairy gates theme because it's bad-ass
```
---
export default FullScreenCode

```js
  // src/utils/typography.js
  import Typography from 'typography'
  import fairyGatesTheme from 'typography-theme-fairy-gates'

  const typography = new Typography(fairyGatesTheme)

  export default typography
```

```notes
- Here we start by defining a utils/typography.js file
- Import the theme
- And apply it
```
---
export default FullScreenCode

```diff
{
  plugins: [
+    {
+       resolve: 'gatsby-plugin-typography',
+       options: {
+         pathToConfigModule: 'src/utils/typography.js',
+       }
+    }
  ]
}
```

```notes
- Then we tell Gatsby we wanna use it
```
---
<Image src='images/ui_step2.png' />

```notes
- It's a little better
- But we can still do better
- And my CSS writing problems still exist
```
---
- Introduction to CSS modules
- Split into component
- Build custom pages
- Link to pages
---
# My notes
- Why `import React`? It's dumb and weird.
- As an experienced JS Dev, I struggled with knowing WTF was going on in some places.
- Example: arrow functions with no curly braces, returning JSX.
- When do I need to wrap with parens and when not?
- Pretty adds semicolons in front of JSX tags sometimes which freaked me out
